[Core Audio Format Specification](https://developer.apple.com/library/archive/documentation/MusicAudio/Reference/CAFSpec/CAF_spec/CAF_spec.html#//apple_ref/doc/uid/TP40001862-CH210-SW1)

この章では、Apple の CoreAudioFormat について説明および指定します。 CAF の機能やファイルのレイアウトなど、CAF の概要については、CAF ファイルの概要を参照してください。

> **重要：** このドキュメントでは、標準の C 構造体と列挙型の宣言を使用して、CAF ファイルヘッダーと CAF チャンクの詳細を指定します。 これは表記上の便宜です。 CAF ファイルのデータは、C コンパイラで解析できず、実際の C 構造体または列挙体を構成しません。 たとえば、CAF ファイルには、正しいバイトアラインメントを保証するためのパッドフィールドはありません。 C からのもう 1 つの違いは、「構造体」内の複数の「フィールド」の長さが異なる可能性があることです。
> 一方、このドキュメントに含まれているものと同様の C 構造体を使用して、CAF ファイルから解析されたデータを保持できます。 この仕様で使用される構造名（CAFAudioFormat など）とフィールド名（mChunkSize など）は任意ですが、それらの多くは AudioToolbox/CAFFile.h で使用される名前に対応しています。

# データ型

> Data Types

CAF ファイルのすべてのフィールドはビッグエンディアン（ネットワーク）バイトオーダーですが、オーディオデータは例外で、データ形式に応じてビッグエンディアンまたはリトルエンディアンになります。 音声データの形式は、音声ガイドチャンクによって記述されます。

CAF ファイルのすべての浮動小数点フィールドは、IEEE-754 仕様に準拠している必要があります。 http://grouper.ieee.org/groups/754/を参照してください。

# CAF ファイルヘッダーとチャンクヘッダー

> CAF File Header and Chunk Headers

CAF ファイルヘッダーと各チャンクのチャンクヘッダーは、すべての CAF ファイルの必須要素です。 それらは、ファイルとそのチャンクを自己記述的にするのに役立ちます。

## CAF ファイルヘッダー

> CAF File Header

CAF ファイルは単純なヘッダーで始まります。 `CAFFileHeader`構造体は、ファイルヘッダーを記述します。

```CAFFileHeader.c
struct CAFFileHeader {
    UInt32  mFileType;
    UInt16  mFileVersion;
    UInt16  mFileFlags;
};
```

### mFileType

ファイルの種類。 この値は`caff` に設定する必要があります。 `mFileType` フィールドが`caff`に設定されているファイルのみを有効な CAF ファイルと見なす必要があります。

### mFileVersion

ファイルバージョン。 この仕様に準拠する CAF ファイルの場合、バージョンを`1` に設定する必要があります。Apple がこの仕様の大幅なリビジョンをリリースする場合、そのリビジョンに準拠するファイルの`mFileVersion` フィールドは`1` より大きい数値に設定されます。

### mFileFlags

将来の使用のために Apple によって予約されたフラグ。 CAF v1 ファイルの場合、`0` に設定する必要があります。理解できないこのフィールドの値は無視し、バージョンとファイルタイプのフィールドが有効である限り、ファイルを有効な CAF ファイルとして受け入れる必要があります。

## CAF チャンクヘッダー

> CAF Chunk Header

CAF ファイルのすべてのチャンクにはヘッダーがあり、そのような各ヘッダーには、`CAFChunkHeader` 構造に示されているように 2 つの必須フィールドが含まれています。

```CAFChunkHeader.c
struct CAFChunkHeader {
    UInt32  mChunkType;
    SInt64  mChunkSize;
};
```

### Audio Description Chunk Data Section

- mSampleRate
  データの 1 秒あたりのサンプルフレーム数。 この値をパケットあたりのフレーム数と組み合わせて、パケットで表される時間を決定できます。 この値はゼロ以外でなければなりません。

- mFormatID
  ストリーム内のデータの一般的な種類を示す 4 文字のコード。 mFormatID フィールドを参照してください。 この値はゼロ以外でなければなりません。

- mFormatFlags
  各フォーマットに固有のフラグ。 フォーマットフラグがないことを示すために 0 に設定できます。 mFormatFlags フィールドを参照してください。

- mBytesPerPacket
  データのパケットのバイト数。 可変パケットサイズのフォーマットの場合、このフィールドは 0 に設定されます。その場合、ファイルにはパケットテーブルチャンクパケットテーブルチャンクが含まれている必要があります。 パケットは常にバイト境界に揃えられます。 可変パケットサイズのフォーマットの音声ガイドチャンクの例については、圧縮オーディオフォーマットを参照してください。

- mFramesPerPacket
  データの各パケット内のサンプルフレームの数。 圧縮形式の場合、このフィールドは各パケットにエンコードされたフレーム数を示します。 パケットあたりのフレーム数が可変のフォーマットの場合、このフィールドは 0 に設定され、ファイルにはパケットテーブルチャンクパケットテーブルチャンクが含まれている必要があります。

- mChannelsPerFrame
  データの各フレームのチャネル数。 この値はゼロ以外でなければなりません。

- mBitsPerChannel
  データフレーム内の各チャネルのサンプルデータのビット数。 データ形式（たとえば、圧縮形式）にチャネルごとに個別のサンプルが含まれていない場合は、このフィールドを 0 に設定する必要があります（圧縮オーディオ形式を参照）。

Audio Description chunkは、同じサイズの 1 つ以上のチャネルを持つ任意の固定ビットレート形式を完全に記述することができます。 可変ビットレートデータの場合、CAF ファイルにはパケットテーブルチャンクも必要です。 パケットテーブルチャンクを参照してください。

CAF ファイルには、任意の数のオーディオチャネルを保存できます。 mChannelsPerFrame フィールドは、データ内の（または圧縮形式のデータにエンコードされた）チャネル数を指定します。 非圧縮形式の場合、mBitsPerChannel フィールドは、各チャネルに割り当てられるビット数を指定します（圧縮形式の場合、このフィールドは 0 です）。 チャネルのレイアウトは、チャネルレイアウトチャンク（チャネルレイアウトチャンク）によって記述されます。



### mFormatFlags Field


```
enum {
    kCAFLinearPCMFormatFlagIsFloat         = (1L << 0),
    kCAFLinearPCMFormatFlagIsLittleEndian  = (1L << 1)
};
```