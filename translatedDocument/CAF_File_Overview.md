[CAF File Overview](https://developer.apple.com/library/archive/documentation/MusicAudio/Reference/CAFSpec/CAF_overview/CAF_overview.html#//apple_ref/doc/uid/TP40001862-CH209-TPXREF101)


# CAFファイル構造

CAFファイルは、ファイルタイプとCAFバージョンを識別するファイルヘッダーで始まり、その後に一連のチャンクが続きます。 チャンクは、チャンクのタイプを定義し、そのデータセクションのサイズを示すヘッダーと、それに続くチャンクデータで構成されます。 データの性質と形式は、チャンクのタイプごとに異なります。


すべてのCAFファイルに必要なチャンクタイプは、オーディオデータチャンク（ご想像のとおり、オーディオデータが含まれています）とオーディオデータ形式を指定するオーディオ記述チャンクの2つだけです。


音声ガイドチャンクは、ファイルヘッダーに続く最初のチャンクである必要があります。 オーディオデータチャンクは、データセクションのサイズが決定されていない限り、ファイル内の他の場所に表示できます。 その場合、オーディオデータチャンクヘッダーのサイズフィールドは-1に設定され、オーディオデータチャンクの終わりがファイルの終わりと同じになるように、オーディオデータチャンクはファイルの最後に来る必要があります。 この配置により、データセクションのサイズをサイズフィールドでその情報が利用できない場合に決定できます。


オーディオは、一連のパケットとしてオーディオデータチャンクに保存されます。  CAFファイルのオーディオパケットには、オーディオデータの1つまたは複数のフレームが含まれています。


CAFは、他のさまざまなチャンクタイプをサポートしており、最初（音声ガイドチャンク用に予約済み）または最後（音声データチャンクサイズフィールドが-1に設定されている場合）を除いて、ファイル内で任意の順序で配置できます。 一部のチャンクタイプは、ファイル内で複数回使用できます。 他のタイプのチャンクを参照する、または参照されるものもあります。


## チャンク構造

すべてのチャンクは、チャンクヘッダーとそれに続くデータセクションで構成されます。 チャンクヘッダーには、次の2つのフィールドが含まれます。

- チャンクのタイプを示す4文字のコード
- チャンクサイズをバイト単位で示す数値


チャンク内のデータの形式は、チャンクのタイプによって異なります。 これは、通常フィールドと呼ばれる一連のセクションで構成されます。 オーディオデータの形式は、データタイプによって異なります。  CAFファイルの他のすべてのフィールドは、ビッグエンディアン（ネットワーク）バイトオーダーです。




## パケット、フレーム、およびサンプル

この仕様を理解するには、次の4つの用語の定義を理解することが重要です。

### Sample

デジタル化されたオーディオデータの1つのチャネルに1つの番号。

### Frame

各チャネルの1つのサンプルを表すサンプルのセット。 フレーム内のサンプルは、一緒に（つまり、同時に）再生することを目的としています。 この定義は、コーデック、ビデオファイル、オーディオまたはビデオ処理アプリケーションによる「フレーム」という用語の使用とは異なる場合があることに注意してください。


### Packet

最小の分割できないデータブロック。 線形PCM（パルス符号変調）データの場合、各パケットには正確に1つのフレームが含まれます。 圧縮されたオーディオデータ形式の場合、パケット内のフレーム数はエンコーディングによって異なります。 たとえば、AACのパケットは1024フレームのPCMを表します。 一部のフォーマットでは、パケットあたりのフレーム数が異なります。


### Sample rate

非圧縮または解凍されたデータの1秒あたりのサンプルの完全なフレームの数。


## チャンクの種類

このセクションでは、CAF仕様で定義されているチャンクのタイプを簡単に紹介します。 すべてのCAFチャンクタイプは、[Core AudioFormatSpecification](https://developer.apple.com/library/archive/documentation/MusicAudio/Reference/CAFSpec/CAF_spec/CAF_spec.html#//apple_ref/doc/uid/TP40001862-CH210-SW1) で完全に説明されています。




### Required

すべてのCAFファイルには、次のチャンクが含まれている必要があります。


- 音声ガイドチャンク。ファイルの音声データ形式を記述します。 このチャンクは、CAFファイルヘッダーの直後に続く必要があります。 [Audio Description Chunk](https://developer.apple.com/library/archive/documentation/MusicAudio/Reference/CAFSpec/CAF_spec/CAF_spec.html#//apple_ref/doc/uid/TP40001862-CH210-BCGGEDGI) を参照してください。
- ファイルのオーディオデータを含むオーディオデータチャンク。 データチャンクのサイズがわからない場合は、ファイルの最後のチャンクである必要があります。 このチャンクのヘッダーでサイズが指定されている場合、チャンクは音声ガイドチャンクの後のどこにでも表示できます。 [Audio Data Chunk](https://developer.apple.com/library/archive/documentation/MusicAudio/Reference/CAFSpec/CAF_spec/CAF_spec.html#//apple_ref/doc/uid/TP40001862-CH210-BCGGEFGJ) を参照してください。
- オーディオパケットのサイズが異なる場合、ファイルには各パケットのサイズを記録するパケットテーブルチャンクが必要です。 [Packet Table Chunk](https://developer.apple.com/library/archive/documentation/MusicAudio/Reference/CAFSpec/CAF_spec/CAF_spec.html#//apple_ref/doc/uid/TP40001862-CH210-BCGBDDAI) を参照してください。


### Channel Layout

3つ以上のチャネルを持つすべてのCAFファイルに必要なチャンクが1つあります。

- チャネルレイアウトチャンク。ファイル内の各チャネルの役割を記述します。 このチャンクは、1チャネルおよび2チャネルのファイルではオプションです。 [Channel Layout Chunk](https://developer.apple.com/library/archive/documentation/MusicAudio/Reference/CAFSpec/CAF_spec/CAF_spec.html#//apple_ref/doc/uid/TP40001862-CH210-BCGCIJCF) を参照してください。



